<section style="margin-bottom: 50px">
  <% if current_user %>
    <div>Welcome, <%= current_user.email  %></div>
    <!-- note to self: the default CRUD method is GET, overriding with DELETE-->
    <div>
      <%= link_to 'Sign Out', destroy_user_session_path, method: :delete %>
    </div>
  <% else %>
    <div>Welcome</div>
    <div>
      <%= link_to 'Sign Up', new_user_registration_path %>
      <%= link_to 'Sign In', user_session_path %>
    </div>
  <% end %>
</section>

<section>
  <% if current_user %>
    <% if @chunking %>
      <h3>You are currently chunking</h3>
    <% else %>
      <%= form_for @chunk, :url => { controller: "chunks", action: "create" } do |f| %>
        <%= label_tag(:title, "Title") %>
        <%= text_field_tag(:title, nil, id: "title") %>
        <%= label_tag(:duration, "How long will the chunk be?") %>
        <%= number_field_tag(:duration, step: 1) %>
        <%= f.submit "Create Chunk" %>
      <% end %>
    <% end %>
  <% end %>
</section>

<section>
  <% if current_user %>
    <h3 id="testy">Chunks</h3>
    <ul id='chunks-list' style="list-style: none">
      <% current_user.chunks.reverse.each do |c| %>
        <li style="margin: 20px" id=<%= c.id %>>
          <div>Title: <%= c.title %></div>
          <div>Started at: <%= c.created_at.in_time_zone("Central Time (US & Canada)").strftime("%H:%M on %m/%d/%Y") %></div>
          <div>Duration: <%= c.duration %></div>

          <div><% e = c.created_at + c.duration.minutes %></div>
          <% if Time.now >= e %>
            <div>Chunk Completed</div>
          <% else %>
            <div>Chunk in Progress</div>
            <div>Completion at <%= e.in_time_zone("Central Time (US & Canada)").strftime("%H:%M") %></div>
          <% end %>
        </li>
      <% end %>
    </ul>
  <% end %>
</section>
